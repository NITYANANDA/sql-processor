/*
 * File: app/controller/Person.js
 *
 * This file was generated by Sencha Architect version 2.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Simplereg.controller.Person', {
    extend: 'Ext.app.Controller',

    statics: {
        setData: function(record, view) {
            var key, field;
            for (key in record.data) {
                field = view.down("#" + key);
                if (field) {
                    field.setValue(record.data[key]);
                }
            }
        }
    },

    onPersonListDblClick: function(dataview, record, item, index, e, eOpts) {
        var view, panel = Ext.getCmp("PersonRegistry"), store,
            title, id = "person" + record.data.id;

        // Get tab
        view = panel.child("#" + id);
        if (!view) {
            view = Ext.create("Simplereg.view.PersonView");
            view.closable = true;
            view.itemId = id;
            panel.add(view);
        }

        // Set title
        title = record.data.firstName + " " + record.data.lastName;
        if (record.data.ssn) title += " | " + record.data.ssn;
        view.setTitle(title);

        // Set data
        Simplereg.controller.Person.setData(record, view);

        // Reference...
        view.record = record;

        // Filter contacts
        store = view.down("#contact_list").getStore();
        store.clearFilter();
        store.filterBy(function(item) {
            return item.get("personId") == record.data.id;
        });

        // Finish
        panel.setActiveTab(view);
    },

    onCancelDialogClick: function(button, e, eOpts) {
        button.up("window").close();
    },

    onSearchPersonClick: function(button, e, eOpts) {
        Ext.getCmp("PersonSearch").show();
    },

    onAcceptSearchClick: function(button, e, eOpts) {
        button.up("window").close();
        alert("SEARCHING...");
    },

    onAddPersonClick: function(button, e, eOpts) {
        Ext.getCmp("PersonAdd").show();
    },

    onAcceptAddClick: function(button, e, eOpts) {
        button.up("window").close();
        alert("ADDING...");
    },

    onDeletePersonClick: function(button, e, eOpts) {
        var dialog = Ext.getCmp("PersonDelete"),
            el = button;

        while (el = el.up()) {
            if (el.record) {
                Simplereg.controller.Person.setData(el.record, dialog);
                dialog.show();
                break;
            }
        }
    },

    onAcceptDeleteClick: function(button, e, eOpts) {
        button.up("window").close();
        alert("DELETING...");
    },

    onModifyPersonClick: function(button, e, eOpts) {
        var dialog = Ext.getCmp("PersonModify"),
            el = button;

        while (el = el.up()) {
            if (el.record) {
                Simplereg.controller.Person.setData(el.record, dialog);
                dialog.show();
                break;
            }
        }
    },

    onAcceptModifyClick: function(button, e, eOpts) {
        button.up("window").close();
        alert("MODIFYING...");
    },

    init: function(application) {
        this.control({
            "#person_list": {
                itemdblclick: this.onPersonListDblClick
            },
            "#cancel_dialog": {
                click: this.onCancelDialogClick
            },
            "#search_person": {
                click: this.onSearchPersonClick
            },
            "#accept_search": {
                click: this.onAcceptSearchClick
            },
            "#add_person": {
                click: this.onAddPersonClick
            },
            "#accept_add": {
                click: this.onAcceptAddClick
            },
            "#delete_person": {
                click: this.onDeletePersonClick
            },
            "#accept_delete": {
                click: this.onAcceptDeleteClick
            },
            "#modify_person": {
                click: this.onModifyPersonClick
            },
            "#accept_modify": {
                click: this.onAcceptModifyClick
            }
        });
    }

});
