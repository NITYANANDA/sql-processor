s1 = CREATE TABLE PERSON \
( \
  ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL \
, NAME VARCHAR(100) NOT NULL  \
);

s2 = ALTER TABLE PERSON ADD CONSTRAINT PK_PERSON \
	PRIMARY KEY (ID) \
;

s3 = CREATE SEQUENCE HIBERNATE_SEQUENCE AS BIGINT START WITH 100 INCREMENT BY 1;

s4 = CREATE TABLE CONTACT \
( \
  ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL \
, PERSON_ID BIGINT NOT NULL  \
, ADDRESS VARCHAR(100) NOT NULL  \
, PHONE_NUMBER VARCHAR(100) \
);

s5 = ALTER TABLE CONTACT ADD CONSTRAINT PK_CONTACT \
	PRIMARY KEY (ID) \
;

s6 = ALTER TABLE CONTACT ADD CONSTRAINT FK_CONTACT_PERSON \
	FOREIGN KEY (PERSON_ID) REFERENCES PERSON (ID) ON DELETE CASCADE \
;

s7 = CREATE TABLE MEDIA \
( \
  ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL \
, TITLE VARCHAR(100) NOT NULL  \
);

s8 = CREATE TABLE MOVIE \
( \
  MEDIA_ID BIGINT NOT NULL  \
, URLIMDB VARCHAR(100) NOT NULL \
, PLAYLENGTH INT NOT NULL \
);

s9 = CREATE TABLE BOOK \
( \
  MEDIA_ID BIGINT NOT NULL  \
, ISBN VARCHAR(100) NOT NULL \
);

s10 = ALTER TABLE MEDIA ADD CONSTRAINT PK_MEDIA \
	PRIMARY KEY (ID) \
;

s11 = ALTER TABLE MOVIE ADD CONSTRAINT FK_MOVIE_MEDIA \
	FOREIGN KEY (MEDIA_ID) REFERENCES MEDIA (ID) ON DELETE CASCADE \
;

s12 = ALTER TABLE BOOK ADD CONSTRAINT FK_BOOK_MEDIA \
	FOREIGN KEY (MEDIA_ID) REFERENCES MEDIA (ID) ON DELETE CASCADE \
;

s13 = CREATE TABLE PERSON_LIBRARY \
( \
  ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL \
, PERSON_ID BIGINT NOT NULL  \
, MEDIA_ID BIGINT NOT NULL  \
);

s14 = ALTER TABLE PERSON_LIBRARY ADD CONSTRAINT PK_PERSON_LIBRARY \
	PRIMARY KEY (ID) \
;

s15 = ALTER TABLE PERSON_LIBRARY ADD CONSTRAINT FK_PERSON_LIBRARY_1 \
	FOREIGN KEY (PERSON_ID) REFERENCES PERSON (ID) ON DELETE CASCADE \
;

s16 = ALTER TABLE PERSON_LIBRARY ADD CONSTRAINT FK_PERSON_LIBRARY_2 \
	FOREIGN KEY (MEDIA_ID) REFERENCES MEDIA (ID) ON DELETE CASCADE \
;

s17 = CREATE TABLE LIBRARY ( \
  ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL \
, NAME VARCHAR(100) NOT NULL \
);

s18 = ALTER TABLE LIBRARY ADD CONSTRAINT PK_LIBRARY \
	PRIMARY KEY (ID) \
;

s19 = CREATE TABLE SUBSCRIBER ( \
  ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL \
, LIBRARY BIGINT NOT NULL \
, CONTACT BIGINT \
, NAME VARCHAR(100) NOT NULL \
);

s20 = ALTER TABLE SUBSCRIBER ADD CONSTRAINT PK_SUBSCRIBER \
	PRIMARY KEY (ID) \
;

s21 = ALTER TABLE SUBSCRIBER ADD CONSTRAINT FK_SUBSCRIBER_LIBRARY \
	FOREIGN KEY (LIBRARY) REFERENCES LIBRARY (ID) ON DELETE CASCADE \
;

s22 = CREATE TABLE BILLING_DETAILS ( \
  ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL \
, SUBSCRIBER BIGINT NOT NULL \
, TYPE VARCHAR(2) NOT NULL \
, CC_NUMBER BIGINT \
, BA_ACCOUNT VARCHAR(100) \
);

s23 = ALTER TABLE BILLING_DETAILS ADD CONSTRAINT PK_BILLING_DETAILS \
	PRIMARY KEY (ID) \
;

s24 = ALTER TABLE BILLING_DETAILS ADD CONSTRAINT FK_BILLING_DETAILS_SUBSCRIBER \
	FOREIGN KEY (SUBSCRIBER) REFERENCES SUBSCRIBER (ID) ON DELETE CASCADE \
;

s25 = CREATE FUNCTION an_hour_before(t TIMESTAMP) \
  RETURNS TIMESTAMP \
  RETURN t - 1 HOUR

s26 = CREATE PROCEDURE new_person(OUT newid INT, IN name VARCHAR(100)) \
  MODIFIES SQL DATA \
  BEGIN ATOMIC \
    INSERT INTO PERSON VALUES (DEFAULT, name); \
    SET newid = IDENTITY(); \
  END
    

